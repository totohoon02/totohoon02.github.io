# Spring 트랜잭션 AOP 동작 흐름

## 명시적(프로그래밍 방식) 트랜잭션 관리

### 트랜잭션 매니저 (Transaction Manager)

- 스프링이 제공하는 트랜잭션 추상화 인터페이스
  `PlatformTransactionManager`의 구현체.
- JDBC 환경: `DataSourceTransactionManager`
- JPA 환경: `JpaTransactionManager`
- 역할: 트랜잭션 시작, 커밋, 롤백, 커넥션 관리.

## 선언적 트랜잭션 관리

### 트랜잭션 AOP 프록시

- `@Transactional` 애노테이션 기반으로 생성되는 프록시 객체.
- 클라이언트 요청이 들어오면 트랜잭션 경계를 설정하고, 트랜잭션
  매니저를 통해 트랜잭션을 시작/종료.

## 트랜잭션 동기화 매니저 (TransactionSynchronizationManager)

- 현재 스레드와 트랜잭션 상태를 동기화하는 역할.
- 트랜잭션이 시작된 커넥션을 보관하여 여러 서비스 동일한 커넥션을 사용 가능하게 함.
- 없으면 메서드 호출 시 커넥션을 직접 전달해야 하는 불편 발생.

## 전체 흐름

1.  클라이언트 요청 → 트랜잭션 AOP 프록시 실행.
2.  프록시는 트랜잭션 매니저에게 트랜잭션 시작 요청.
3.  트랜잭션 매니저는 데이터소스에서 커넥션을 획득 후 트랜잭션 시작.
4.  획득한 커넥션은 트랜잭션 동기화 매니저에 보관.
5.  서비스 로직 호출 시 동기화 매니저에서 동일 커넥션 사용.
6.  트랜잭션 종료 시 트랜잭션 매니저가 동기화 매니저로부터 커넥션을
    가져와 커밋/롤백 후 반환.

## 핵심 요약

- 트랜잭션 매니저: 트랜잭션의 시작/종료를 관리.
- 트랜잭션 동기화 매니저: 트랜잭션 커넥션을 여러 계층에서 공유하도록
  관리.
- 트랜잭션 AOP 프록시: 선언적 트랜잭션을 가능하게 해주는 진입 지점.
- 선언적 방법도 내부적으로 `TranscationManager` 사용
- 동기화 매니저는 자원 상태를 스레드에 저장/관리(하나의 트랜잭션, 다른 스레드 시에 커넥션 공유 등)

### 관계도

1. 추상화
   - TxManager > AOP
2. 동작 순서
   - AOP > TxManager
3. 보조
   - TxSyncManager

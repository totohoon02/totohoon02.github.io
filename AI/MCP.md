# MCP (Model Context Protocol)

- 모델이 외부 기능과 구조적으로 상호작용 하기 위한 표준 프로토콜
- LLM 모델이 직접 코드 실행, DB 조회, API 호출할 수 있게 허용

## 역할

- Host
  - LLM이 실행되는 환경
  - Cursor, VSCode
  - Client를 포함하거나 연결
  - 입출력, MCP 호출을 오케스트레이션
- Client
  - Host 내부에서 Server와 통신하는 중간자
  - LLM의 도구 호출을 표준 MCP 요청 포맷으로 변환
  - 응답을 받아 LLM이 이해할 수 있도록 변환
- Server
  - MCP 표준을 구현한 기능 제공자

```
[User]
   ↓
[LLM in Host] ←──> [MCP Client] ←──> [MCP Server #1] (예: DB 조회)
                        │
                        └──> [MCP Server #2] (예: API 호출)
```

## 동작 원리

- JSON-RPC/HTTP

```python
{
  "jsonrpc": "2.0",
  "id": "123",
  "method": "callTool",
  "params": {
    "name": "get_weather",
    "arguments": { "city": "Seoul" }
  }
}
```

1. 연결
   - Client가 Server와의 세션 생성
   - Server에서 Tool 목록과 Schema를 Client에 전달
   - 해당 정보를 LLM에 등록
2. 요청
   - LLM이 대화 중 `get_weather`라는 Tool 호출 필요 판단
   - Client가 `JSON-RPC`형식으로 호출 파라미터 생성
   - Server로 JSON 전달
3. 처리
   - Server는 Tool 실행
   - 결과를 JSON Schema 형식으로 직렬화
4. 응답
   - Client로 응답 전송
   - Client가 LLM이 이해할 수 있는 형식으로 전달
   - LLM은 응답을 반영해 사용자에 보여줌

## 요청 방식

1. STDIO

   - 클라이언트가 서버를 로컬 프로세스 실행
   - stdin/stdout으로 메시지를 주고 받는 형식
   - 장점
     - 네트워크 오버헤드 없음(네트워크 사용 x), 단순 연결
     - Server가 CLI 프로그램 같이 동작
     - IDE, 데스크톱 앱
   - 단점
     - 원격 서버 불가
     - 프로세스 수명 관리 책임
     - 다중 세션 관리 어려움

2. Stremable HTTP

   - HTTP 기반 양방향 스트리밍
   - 장점
     - 원격 연결 가능
     - 방화벽/프록시 환경에서도 동작(HTTP 기반이므로)
     - 대용량 데이터 전송 시 스트리밍 처리 가능(메모리 절약)
     - 단일 채널로 요청–응답 관리 용이
   - 단점
     - HTTP 연결 오버헤드 존재
     - 서버 구현이 스트리밍을 지원해야 함
     - 순수 STDIO보다 지연(latency) 증가 가능

3. HTTP + SSE

   - 요청은 HTTP, 응답은 SSE로 처리(SSE는 단방향)
   - 장점
     - 구현 단순(브라우저/HTTP 클라이언트 기본 지원)
     - 방화벽 친화적(HTTP 기반)
     - 서버가 여러 개의 이벤트를 순차적으로 전송 가능 → 진행 상황 업데이트에 적합
   - 단점
     - 서버→클라이언트 단방향이라, 클라이언트→서버 추가 요청이 필요할 때는 별도 HTTP 호출 필요
     - 이진 데이터 전송 불편(텍스트 기반)
     - WebSocket보다 기능 제한

| 구분              | Streamable HTTP                                                         | HTTP + SSE                                                                |
| ----------------- | ----------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| **스트리밍 방향** | **양방향** (Client ↔ Server)                                            | **단방향** (Server → Client)                                              |
| **연결 방식**     | 하나의 HTTP 연결을 유지하면서 요청과 응답을 **동시에** 주고받을 수 있음 | 요청은 **일반 HTTP**로 보내고, 응답은 **SSE 채널**을 통해 서버에서만 전송 |
| **메시지 형태**   | JSON-RPC 메시지를 HTTP 스트림에 그대로 실어 보냄 (바이너리/텍스트 가능) | SSE 표준 포맷(`event:`, `data:`) 사용, 텍스트 기반                        |
| **사용 시나리오** | LLM과 MCP Server가 상호 대화하며 실시간 데이터 교환                     | LLM이 요청만 보내고 서버가 결과·진행률을 **계속 푸시**                    |
| **유연성**        | 서버와 클라이언트 모두 스트리밍 가능 → 대화형 프로토콜 구현에 적합      | 서버→클라이언트 알림·토큰 스트리밍에는 간단하고 최적                      |

- 전화와 라디오?의 차이
